<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Reset & Base Styles --- */
        :root {
            --bg-color: #f4f4f5;
            --card-bg: #ffffff;
            --primary: #18181b;
            --primary-light: #3f3f46;
            --secondary: #71717a;
            --border-color: #e4e4e7;
            --success: #16a34a;
            --error: #dc2626;
            --font-family: 'Inter', sans-serif;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        button, input {
            font-family: inherit;
        }
        input:focus {
            outline: none;
        }

        /* --- Main Containers --- */
        .app-container {
            display: none; /* Hidden by default, shown after auth */
            flex-direction: column;
            height: 100%;
            background-color: var(--bg-color);
        }
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 24px;
            background-color: var(--card-bg);
        }

        /* --- Login Screen Styles --- */
        .login-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary);
        }
        .login-subtitle {
            font-size: 16px;
            color: var(--secondary);
            margin-bottom: 32px;
            text-align: center;
        }
        .login-form {
            width: 100%;
            max-width: 400px;
        }
        .login-input {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 16px;
            background-color: var(--bg-color);
        }
        .login-input:focus {
            border-color: var(--primary);
        }
        .login-button {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background-color: var(--primary);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .login-button:hover {
            background-color: var(--primary-light);
        }
        .error-message {
            color: var(--error);
            margin-top: 16px;
            text-align: center;
            font-weight: 500;
        }

        /* --- Admin Panel Header --- */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .admin-header-title {
            font-size: 18px;
            font-weight: 600;
        }
        .logout-button {
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--primary);
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }
        
        /* --- Search Bar --- */
        .search-container {
            padding: 16px;
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
        }
        .search-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--bg-color);
        }

        /* --- Product List --- */
        .product-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .product-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            margin-bottom: 16px;
            padding: 16px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .product-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .product-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            background-color: var(--bg-color);
        }
        .product-details {
            flex: 1;
        }
        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }
        .product-specs-current {
            font-size: 14px;
            color: var(--secondary);
            font-weight: 500;
        }
        .product-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }
        .price-input {
            flex-grow: 1;
            padding: 12px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            -moz-appearance: textfield;
        }
        .price-input::-webkit-outer-spin-button,
        .price-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .update-button, .delete-button {
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .update-button {
            background-color: var(--primary);
            min-width: 100px;
        }
        .update-button.success {
            background-color: var(--success);
        }
        .delete-button {
             background-color: var(--error);
             min-width: 44px;
        }

        /* --- Loader / Spinner --- */
        .loader {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- Global Loader --- */
        .global-loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .global-loader .loader {
            width: 40px;
            height: 40px;
            border-color: rgba(0,0,0,0.1);
            border-top-color: var(--primary);
        }
    </style>
</head>
<body>

    <div id="login-container" class="login-container">
        <h1 class="login-title">Panneau Admin</h1>
        <p class="login-subtitle">Connectez-vous pour gérer les produits.</p>
        <form id="login-form" class="login-form">
            <input type="email" id="email" class="login-input" placeholder="Email" required>
            <input type="password" id="password" class="login-input" placeholder="Mot de passe" required>
            <button type="submit" class="login-button">Se connecter</button>
        </form>
        <p id="login-error" class="error-message" style="display: none;"></p>
    </div>

    <div id="app-container" class="app-container">
        <header class="admin-header">
            <h1 class="admin-header-title">Gestion des Produits</h1>
            <button id="logout-button" class="logout-button">Déconnexion</button>
        </header>
        
        <div class="search-container">
            <input type="text" id="search-input" class="search-input" placeholder="Rechercher un produit...">
        </div>

        <main id="product-list" class="product-list">
            <div class="global-loader"><div class="loader"></div></div>
        </main>
    </div>

    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyDNYwc40OWGXHrOOqqPYTB_jDGJmI7Mc1M",
            authDomain: "africaphone-vente.firebaseapp.com",
            projectId: "africaphone-vente",
            storageBucket: "africaphone-vente.appspot.com",
            messagingSenderId: "203471818329",
            appId: "1:203471818329:web:c2c77d48098c1a6a596b48"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, orderBy, query } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutButton = document.getElementById('logout-button');
        const productListContainer = document.getElementById('product-list');
        const searchInput = document.getElementById('search-input');

        let allProducts = [];

        onAuthStateChanged(auth, user => {
            if (user) {
                loginContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                loadProducts();
            } else {
                loginContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            loginError.style.display = 'none';
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                loginError.textContent = "Email ou mot de passe incorrect.";
                loginError.style.display = 'block';
            }
        });

        logoutButton.addEventListener('click', () => signOut(auth));

        async function loadProducts() {
            productListContainer.innerHTML = `<div class="global-loader"><div class="loader"></div></div>`;
            try {
                const q = query(collection(db, "products"), orderBy("name"));
                const querySnapshot = await getDocs(q);
                
                allProducts = [];
                productListContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    productListContainer.innerHTML = '<p>Aucun produit trouvé.</p>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const product = { id: doc.id, ...doc.data() };
                    allProducts.push(product);
                    productListContainer.appendChild(createProductCard(product));
                });

            } catch (error) {
                console.error("Error loading products:", error);
                productListContainer.innerHTML = '<p style="color: var(--error);">Erreur chargement.</p>';
            }
        }
        
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.dataset.productId = product.id;
            card.dataset.productName = product.name.toLowerCase();

            const currentPriceFormatted = `Prix : ${new Intl.NumberFormat('fr-FR').format(product.price)} FCFA`;
            const currentSpecs = `Specs : ${product.rom || '?'}GB ROM / ${product.ram || '?'}GB RAM`;

            card.innerHTML = `
                <div class="product-info">
                    <img src="${product.imageUrl}" alt="${product.name}" class="product-image" loading="lazy">
                    <div class="product-details">
                        <p class="product-name">${product.name}</p>
                        <p class="product-specs-current">${currentSpecs}</p>
                    </div>
                </div>
                <div class="product-actions">
                    <input type="number" class="price-input" placeholder="Nouveau prix" value="${product.price}">
                    <button class="update-button">Mettre à jour</button>
                    <button class="delete-button" title="Supprimer le produit">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: white;"><path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    </button>
                </div>
            `;
            
            card.querySelector('.update-button').addEventListener('click', () => handlePriceUpdate(product.id, card));
            card.querySelector('.delete-button').addEventListener('click', () => handleProductDelete(product.id, product.name, card));

            return card;
        }

        async function handlePriceUpdate(productId, cardElement) {
            const input = cardElement.querySelector('.price-input');
            const button = cardElement.querySelector('.update-button');
            const newPrice = parseFloat(input.value);

            if (isNaN(newPrice) || newPrice < 0) {
                alert("Veuillez entrer un prix valide.");
                return;
            }

            button.innerHTML = '<div class="loader"></div>';
            button.disabled = true;

            try {
                const productRef = doc(db, "products", productId);
                await updateDoc(productRef, {
                    price: newPrice
                });
                
                button.innerHTML = '✓';
                button.classList.add('success');
                
                setTimeout(() => {
                    button.innerHTML = 'Mettre à jour';
                    button.classList.remove('success');
                    button.disabled = false;
                }, 2000);

            } catch (error) {
                console.error("Error updating price:", error);
                alert("Erreur lors de la mise à jour.");
                button.innerHTML = 'Mettre à jour';
                button.disabled = false;
            }
        }

        async function handleProductDelete(productId, productName, cardElement) {
            if (!confirm(`Êtes-vous sûr de vouloir supprimer le produit "${productName}" ?`)) return;

            try {
                await deleteDoc(doc(db, "products", productId));
                cardElement.style.transition = 'opacity 0.5s ease';
                cardElement.style.opacity = '0';
                setTimeout(() => cardElement.remove(), 500);
            } catch (error) {
                console.error("Error deleting product:", error);
                alert("Erreur lors de la suppression.");
            }
        }

        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('.product-card').forEach(card => {
                card.style.display = card.dataset.productName.includes(searchTerm) ? 'flex' : 'none';
            });
        });

    </script>
</body>
</html>
